---
import { Image } from 'astro:assets';

export interface Props {
  title: string;
  client?: string;
  createdDate?: string;
  categories?: { name: string; color: string }[];
  coverImageUrl?: string;
  workId: string;
  isPrivate: boolean;
  /** 指定時は <a> でラップ、未指定時は <article> */
  href?: string;
  /** works ページのフィルタ/ソート用。指定時のみ data-work-* を付与 */
  dataWorkTitle?: string;
  dataWorkDate?: string;
  dataWorkCategories?: string;
}

const {
  title,
  client = '',
  createdDate = '',
  categories = [],
  coverImageUrl = '',
  workId,
  isPrivate,
  href,
  dataWorkTitle,
  dataWorkDate,
  dataWorkCategories,
} = Astro.props;

function getNotionCategoryColor(colorName: string): string {
  const colorMap: Record<string, string> = {
    default: 'var(--c-notion-default)',
    gray: 'var(--c-notion-gray)',
    brown: 'var(--c-notion-brown)',
    red: 'var(--c-notion-red)',
    orange: 'var(--c-notion-orange)',
    yellow: 'var(--c-notion-yellow)',
    green: 'var(--c-notion-green)',
    blue: 'var(--c-notion-blue)',
    purple: 'var(--c-notion-purple)',
    pink: 'var(--c-notion-pink)',
  };
  return colorMap[colorName] || colorMap.default;
}

const coverSrc = isPrivate ? '/images/private-sample.png' : coverImageUrl;
const hasDataAttrs = dataWorkTitle !== undefined;
---

{
  href ? (
    <a
      href={href}
      class="work-card work-card--link"
      {...(hasDataAttrs && {
        'data-work-title': dataWorkTitle,
        'data-work-date': dataWorkDate ?? '',
        'data-work-private': 'false',
        'data-work-categories': dataWorkCategories ?? '',
      })}
    >
      {coverSrc ? (
        <div class="work-cover">
          <Image src={coverSrc} alt={isPrivate ? 'Private work sample' : title} width={520} height={390} loading="lazy" />
        </div>
      ) : null}
      <div class="work-content">
        <h2 class="work-card-title">{title}</h2>
        {createdDate ? <p class="work-date">{createdDate}</p> : null}
        {categories.length > 0 ? (
          <div class="work-categories">
            {categories.map((cat) => (
              <span class="work-category-tag" style={`background-color: ${getNotionCategoryColor(cat.color)}`}>
                {cat.name}
              </span>
            ))}
          </div>
        ) : null}
      </div>
    </a>
  ) : (
    <article
      class="work-card"
      {...(hasDataAttrs && {
        'data-work-title': dataWorkTitle,
        'data-work-date': dataWorkDate ?? '',
        'data-work-private': 'true',
        'data-work-categories': dataWorkCategories ?? '',
      })}
    >
      {coverSrc ? (
        <div class="work-cover">
          <Image src={coverSrc} alt={isPrivate ? 'Private work sample' : title} width={520} height={390} loading="lazy" />
        </div>
      ) : null}
      <div class="work-content">
        <h2 class="work-card-title">{title}</h2>
        {createdDate ? <p class="work-date">{createdDate}</p> : null}
        {categories.length > 0 ? (
          <div class="work-categories">
            {categories.map((cat) => (
              <span class="work-category-tag" style={`background-color: ${getNotionCategoryColor(cat.color)}`}>
                {cat.name}
              </span>
            ))}
          </div>
        ) : null}
      </div>
    </article>
  )
}

<style lang="sass">
  .work-card
    overflow: hidden
    background-color: var(--c-white)
    display: flex
    flex-direction: column

  .work-card--link
    text-decoration: none
    color: inherit
    display: flex
    flex-direction: column

  .work-cover
    width: 100%

    img
      width: 100%
      height: auto
      object-fit: contain

  .work-card-title
    margin: 0 0 8px 0
    font-size: 16px
    color: var(--c-gray-925)

  .work-client
    color: var(--c-gray-600)
    font-size: 14px
    margin: 2px 0

  .work-date
    color: var(--c-gray-500)
    font-size: 12px
    margin-top: 4px

  .work-categories
    display: flex
    flex-wrap: wrap
    gap: 6px
    margin-top: 10px

  /* 画像以外（テキストなど）のエリアの高さをそろえる */
  .work-content
    min-height: 140px

  .work-category-tag
    padding: 2px 6px 4px 6px
    border-radius: 4px
    font-size: 16px
    font-family: 'Zen Kaku Gothic New', sans-serif
    font-weight: 700
    color: var(--c-white)
    opacity: 0.9
</style>
