---
import { Image } from 'astro:assets';

export interface Props {
  title: string;
  client?: string;
  createdDate?: string;
  categories?: { name: string; color: string }[];
  coverImageUrl?: string;
  workId: string;
  isPrivate: boolean;
  /** 指定時は <a> でラップ、未指定時は <article> */
  href?: string;
  /** works ページのフィルタ/ソート用。指定時のみ data-work-* を付与 */
  dataWorkTitle?: string;
  dataWorkDate?: string;
  dataWorkCategories?: string;
}

const {
  title,
  client = '',
  createdDate = '',
  categories = [],
  coverImageUrl = '',
  workId,
  isPrivate,
  href,
  dataWorkTitle,
  dataWorkDate,
  dataWorkCategories,
} = Astro.props;

const coverSrc = isPrivate ? '/images/private-sample.png' : coverImageUrl;
const hasDataAttrs = dataWorkTitle !== undefined;
---

{
  href ? (
    <a
      href={href}
      class="work-card work-card--link"
      {...(hasDataAttrs && {
        'data-work-title': dataWorkTitle,
        'data-work-date': dataWorkDate ?? '',
        'data-work-private': 'false',
        'data-work-categories': dataWorkCategories ?? '',
      })}
    >
      {coverSrc ? (
        <div class="work-cover">
          <Image
            src={coverSrc}
            alt={isPrivate ? 'Private work sample' : title}
            width={520}
            height={390}
            loading="lazy"
          />
        </div>
      ) : null}
      <div class="work-content">
        <h2 class="work-card-title">{title}</h2>
        {createdDate ? <p class="work-date">{createdDate}</p> : null}
        {categories.length > 0 ? (
          <div class="work-categories">
            {categories.map((cat) => (
              <span class="work-category-tag">{cat.name}</span>
            ))}
          </div>
        ) : null}
      </div>
    </a>
  ) : (
    <article
      class="work-card"
      {...(hasDataAttrs && {
        'data-work-title': dataWorkTitle,
        'data-work-date': dataWorkDate ?? '',
        'data-work-private': 'true',
        'data-work-categories': dataWorkCategories ?? '',
      })}
    >
      {coverSrc ? (
        <div class="work-cover">
          <Image
            src={coverSrc}
            alt={isPrivate ? 'Private work sample' : title}
            width={520}
            height={390}
            loading="lazy"
          />
        </div>
      ) : null}
      <div class="work-content">
        <h2 class="work-card-title">{title}</h2>
        {createdDate ? <p class="work-date">{createdDate}</p> : null}
        {categories.length > 0 ? (
          <div class="work-categories">
            {categories.map((cat) => (
              <span class="work-category-tag">{cat.name}</span>
            ))}
          </div>
        ) : null}
      </div>
    </article>
  )
}

<style lang="sass">
  @use '../styles/spacing' as *
  .work-card
    overflow: hidden
    background-color: var(--c-white)
    display: flex
    flex-direction: column

  .work-card--link
    text-decoration: none
    color: inherit
    display: flex
    flex-direction: column

  .work-cover
    width: 100%

    img
      width: 100%
      height: auto
      object-fit: contain

  .work-card-title
    margin: space(0) space(0) space(2) space(0)
    font-size: var(--type-body-size) !important
    font-family: var(--font-heading)
    font-weight: var(--type-h2-weight)
    color: var(--c-gray-800)

  .work-client
    color: var(--c-gray-400)
    font-size: var(--type-caption-size)
    line-height: var(--type-caption-line)
    margin: space(1) 0

  .work-date
    color: var(--c-gray-400)
    font-size: var(--type-caption-size)
    line-height: var(--type-caption-line)
    margin-top: space(1)

  .work-categories
    display: flex
    flex-wrap: wrap
    gap: space(2)
    margin-top: space(3)

  /* 画像以外（テキストなど）のエリアの高さをそろえる */
  .work-content
    min-height: 140px

  .work-category-tag
    padding: space(1) space(2) space(1) space(2)
    border: 2px solid var(--c-gray-800)
    border-radius: 4px
    font-size: var(--type-body-size)
    font-family: var(--font-ui)
    font-weight: var(--type-h2-weight)
    color: var(--c-gray-800)
    background: transparent
</style>
