---
export interface Props {
  title: string;
  client?: string;
  createdDate?: string;
  categories?: { name: string; color: string }[];
  coverImageUrl?: string;
  workId: string;
  isPrivate: boolean;
  /** 指定時は <a> でラップ、未指定時は <article> */
  href?: string;
  /** works ページのフィルタ/ソート用。指定時のみ data-work-* を付与 */
  dataWorkTitle?: string;
  dataWorkDate?: string;
  dataWorkCategories?: string;
}

const {
  title,
  client = '',
  createdDate = '',
  categories = [],
  coverImageUrl = '',
  workId,
  isPrivate,
  href,
  dataWorkTitle,
  dataWorkDate,
  dataWorkCategories,
} = Astro.props;

function getNotionCategoryColor(colorName: string): string {
  const colorMap: Record<string, string> = {
    default: '#373530',
    gray: '#9B9A97',
    brown: '#64473A',
    red: '#E03E3E',
    orange: '#D9730D',
    yellow: '#DFAB01',
    green: '#0F7B6C',
    blue: '#0B6E99',
    purple: '#6940A5',
    pink: '#AD1A72',
  };
  return colorMap[colorName] || colorMap.default;
}

const coverSrc = isPrivate ? '/images/private-sample.png' : coverImageUrl;
const hasDataAttrs = dataWorkTitle !== undefined;
---

{
  href ? (
    <a
      href={href}
      class="work-card work-card--link"
      {...(hasDataAttrs && {
        'data-work-title': dataWorkTitle,
        'data-work-date': dataWorkDate ?? '',
        'data-work-private': 'false',
        'data-work-categories': dataWorkCategories ?? '',
      })}
    >
      {coverSrc ? (
        <div class="work-cover">
          <img src={coverSrc} alt={isPrivate ? 'Private work sample' : title} loading="lazy" />
        </div>
      ) : null}
      <div class="work-content">
        <h2 class="work-card-title">{title}</h2>
        {createdDate ? <p class="work-date">{createdDate}</p> : null}
        {categories.length > 0 ? (
          <div class="work-categories">
            {categories.map((cat) => (
              <span class="work-category-tag" style={`background-color: ${getNotionCategoryColor(cat.color)}`}>
                {cat.name}
              </span>
            ))}
          </div>
        ) : null}
      </div>
    </a>
  ) : (
    <article
      class="work-card"
      {...(hasDataAttrs && {
        'data-work-title': dataWorkTitle,
        'data-work-date': dataWorkDate ?? '',
        'data-work-private': 'true',
        'data-work-categories': dataWorkCategories ?? '',
      })}
    >
      {coverSrc ? (
        <div class="work-cover">
          <img src={coverSrc} alt={isPrivate ? 'Private work sample' : title} loading="lazy" />
        </div>
      ) : null}
      <div class="work-content">
        <h2 class="work-card-title">{title}</h2>
        {createdDate ? <p class="work-date">{createdDate}</p> : null}
        {categories.length > 0 ? (
          <div class="work-categories">
            {categories.map((cat) => (
              <span class="work-category-tag" style={`background-color: ${getNotionCategoryColor(cat.color)}`}>
                {cat.name}
              </span>
            ))}
          </div>
        ) : null}
      </div>
    </article>
  )
}

<style lang="sass">
  .work-card
    overflow: hidden
    background-color: #ffffff

  .work-card--link
    text-decoration: none
    color: inherit
    display: block

  .work-cover
    width: 100%
    height: 180px
    overflow: hidden

    img
      width: 100%
      height: 100%
      object-fit: cover

  .work-card-title
    margin: 0 0 8px 0
    font-size: 16px
    color: #111111

  .work-client
    color: #777777
    font-size: 14px
    margin: 2px 0

  .work-date
    color: #999999
    font-size: 12px
    margin-top: 4px

  .work-categories
    display: flex
    flex-wrap: wrap
    gap: 6px
    margin-top: 10px

  .work-category-tag
    padding: 2px 6px 4px 6px
    border-radius: 4px
    font-size: 16px
    font-family: 'Zen Kaku Gothic New', sans-serif
    font-weight: 700
    color: #ffffff
    opacity: 0.9
</style>
