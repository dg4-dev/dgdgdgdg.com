---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Header from '@/components/header.astro';
import { getNotionData } from '@/lib/notion';
import Footer from '@/components/footer.astro';

// Notionデータベースからデータを取得
const notionData = await getNotionData();
console.log('=== Works Page: Notion Data ===');
console.log(JSON.stringify(notionData, null, 2));

// Privateでないものだけフィルタリング
const works = notionData.results.filter((item: any) => !item.properties?.Private?.checkbox);
---

<BaseLayout title="Works - dgdgdgdg" description="制作実績の一覧" keywords="works, portfolio, projects">
  <Fragment slot="head">
    <!-- ページ固有の追加メタタグやスクリプトをここに記述可能 -->
  </Fragment>
  <Header />
  <main>
    <div class="works-grid">
      {
        works.map((item: any) => {
          const title = item.properties?.Title?.title?.[0]?.plain_text ?? 'No title';
          const client = item.properties?.Client?.rich_text?.[0]?.plain_text ?? '';
          const createdDate = item.properties?.['Created Date']?.date?.start ?? '';
          const categories = item.properties?.Category?.multi_select ?? [];
          const coverImage = item.properties?.Cover?.files?.[0]?.file?.url ?? '';
          const workId = item.properties?.id?.rich_text?.[0]?.plain_text ?? item.id;

          return (
            <article class="work-card">
              <a href={`/works/${workId}`}>
                {coverImage && (
                  <div class="work-cover">
                    <img src={coverImage} alt={title} />
                  </div>
                )}
                <div class="work-content">
                  <h2>{title}</h2>
                  {client && <p class="work-client">Client: {client}</p>}
                  {createdDate && <p class="work-date">{createdDate}</p>}
                  {categories.length > 0 && (
                    <div class="work-categories">
                      {categories.map((cat: any) => (
                        <span class="category-tag" style={`background-color: ${cat.color}`}>
                          {cat.name}
                        </span>
                      ))}
                    </div>
                  )}
                </div>
              </a>
            </article>
          );
        })
      }
    </div>

    <!-- prettied json view -->
    <details>
      <summary>デバッグ: JSON表示</summary>
      <pre>{JSON.stringify(notionData, null, 2)}</pre>
    </details>
  </main>
  <Footer />
</BaseLayout>

<style lang="scss">
  main {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }

  h1 {
    margin-bottom: 2rem;
  }

  .works-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
  }

  .work-card {
    border: 1px solid #ddd;
    border-radius: 8px;
    overflow: hidden;
    transition:
      transform 0.2s,
      box-shadow 0.2s;

    &:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    a {
      text-decoration: none;
      color: inherit;
      display: block;
    }
  }

  .work-cover {
    width: 100%;
    height: 200px;
    overflow: hidden;

    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  }

  .work-content {
    padding: 1.5rem;

    h2 {
      margin: 0 0 0.5rem 0;
      font-size: 1.25rem;
    }

    .work-client {
      color: #666;
      font-size: 0.9rem;
      margin: 0.25rem 0;
    }

    .work-date {
      color: #999;
      font-size: 0.85rem;
      margin: 0.25rem 0;
    }

    .work-categories {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.75rem;

      .category-tag {
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.75rem;
        opacity: 0.8;
      }
    }
  }

  details {
    margin-top: 3rem;

    summary {
      cursor: pointer;
      padding: 0.5rem;
      background: #f5f5f5;
      border-radius: 4px;
    }

    pre {
      margin-top: 1rem;
      padding: 1rem;
      background: #f5f5f5;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 0.85rem;
    }
  }
</style>
