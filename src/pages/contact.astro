---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Header from '@/components/header.astro';
import Footer from '@/components/footer.astro';
import XIcon from '@/components/icons/XIcon.astro';
import InstagramIcon from '@/components/icons/InstagramIcon.astro';
import NoteIcon from '@/components/icons/NoteIcon.astro';
import YoutubeIcon from '@/components/icons/YoutubeIcon.astro';
import SuzuriIcon from '@/components/icons/SuzuriIcon.astro';
import ZennIcon from '@/components/icons/ZennIcon.astro';
import GithubIcon from '@/components/icons/GithubIcon.astro';

export const prerender = false;

type Status = 'open' | 'limited' | 'closed';

const STATUS_ENDPOINT =
  import.meta.env.PUBLIC_STATUS_ENDPOINT ?? 'https://<your-status-worker-subdomain>.workers.dev/status';

interface StatusResponse {
  status?: string;
}

let status: Status | 'unknown' = 'open';

try {
  const res = await fetch(STATUS_ENDPOINT, {
    headers: {
      Accept: 'application/json',
    },
  });

  if (res.ok) {
    const data = (await res.json()) as StatusResponse;
    if (data && (data.status === 'open' || data.status === 'limited' || data.status === 'closed')) {
      status = data.status;
    } else {
      status = 'unknown';
    }
  } else {
    status = 'unknown';
  }
} catch {
  status = 'unknown';
}

let statusLabel = '';
let statusMessage = '';
let statusClass = '';

if (status === 'open') {
  statusLabel = 'STATUS: OPEN';
  statusMessage = '現在、通常通りご依頼をお受けできます。';
  statusClass = 'status-banner--open';
} else if (status === 'limited') {
  statusLabel = 'STATUS: LIMITED';
  statusMessage = '現在、内容によってはお時間をいただく場合があります。';
  statusClass = 'status-banner--limited';
} else if (status === 'closed') {
  statusLabel = 'STATUS: CLOSED';
  statusMessage = '現在、新規のご依頼受付を停止しています。';
  statusClass = 'status-banner--closed';
} else {
  statusLabel = 'STATUS: UNKNOWN';
  statusMessage = 'ステータスを取得できませんでした（暫定: LIMITED）。';
  statusClass = 'status-banner--limited';
}

const iconComponents = {
  x: XIcon,
  instagram: InstagramIcon,
  note: NoteIcon,
  youtube: YoutubeIcon,
  suzuri: SuzuriIcon,
  zenn: ZennIcon,
  github: GithubIcon,
};

const socialLinks = [
  { name: 'X', url: 'https://x.com/dg4_design', iconId: 'x' as const },
  { name: 'Instagram', url: 'https://instagram.com/dg4_design', iconId: 'instagram' as const },
  { name: 'Note', url: 'https://note.com/dg4_design', iconId: 'note' as const },
  { name: 'YouTube', url: 'https://www.youtube.com/@dg4_design', iconId: 'youtube' as const },
  { name: 'Suzuri', url: 'https://suzuri.jp/dg4_design', iconId: 'suzuri' as const },
  { name: 'Zenn', url: 'https://zenn.dev/dg4_design', iconId: 'zenn' as const },
  { name: 'GitHub', url: 'https://github.com/dg4-design', iconId: 'github' as const },
];
---

<BaseLayout
  title="Contact - dgdgdgdg"
  description="dgdgdgdgへのお問い合わせは、Messenger・メールまたは各SNSからお気軽にどうぞ。お仕事のご依頼・ご相談を受け付けています。リアルタイムで現在の受付状況も掲載。"
  keywords="contact, SNS, dgdgdgdg"
>
  <Fragment slot="head"> </Fragment>
  <Header />
  <main>
    <section class="contact-hero">
      <p class="contact-description">
        お仕事のご依頼・ご相談は、Messenger・メール<br />または各SNSからお気軽にどうぞ。
      </p>
      <div class={`status-banner ${statusClass}`}>
        <span class="status-indicator" aria-label={statusLabel} title={statusLabel}></span>
        <span class="status-message">{statusMessage}</span>
      </div>
    </section>

    <section class="primary-contacts">
      <a href="https://m.me/dg4.design" target="_blank" rel="noopener noreferrer" class="social-link-card">
        <span class="social-icon">
          <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"
            ><path
              d="M12 0C5.373 0 0 4.975 0 11.111c0 3.497 1.745 6.616 4.472 8.652V24l4.086-2.242c1.09.301 2.246.464 3.442.464 6.627 0 12-4.974 12-11.111C24 4.975 18.627 0 12 0zm1.193 14.963l-3.056-3.259-5.963 3.259L10.733 8.2l3.13 3.259L19.776 8.2l-6.583 6.763z"
            ></path></svg
          >
        </span>
        <span class="social-name">Messenger</span>
        <span class="social-arrow">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="7" y1="17" x2="17" y2="7"></line>
            <polyline points="7 7 17 7 17 17"></polyline>
          </svg>
        </span>
      </a>
      <a href="mailto:contact@dgdgdgdg.com" class="social-link-card">
        <span class="social-icon">
          <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"
            ><path
              d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"
            ></path></svg
          >
        </span>
        <span class="social-name">Email</span>
        <span class="social-arrow">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="7" y1="17" x2="17" y2="7"></line>
            <polyline points="7 7 17 7 17 17"></polyline>
          </svg>
        </span>
      </a>
    </section>

    <section class="social-links">
      {
        socialLinks.map((link) => {
          const IconComponent = iconComponents[link.iconId];
          return (
            <a href={link.url} target="_blank" rel="noopener noreferrer" class="social-link-card">
              <span class="social-icon">
                <IconComponent />
              </span>
              <span class="social-name">{link.name}</span>
              <span class="social-arrow">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="7" y1="17" x2="17" y2="7" />
                  <polyline points="7 7 17 7 17 17" />
                </svg>
              </span>
            </a>
          );
        })
      }
    </section>
  </main>
  <Footer />
</BaseLayout>

<style lang="sass">
  main
    background-color: var(--c-black)
    min-height: 100vh
    padding: 160px 80px 120px
    display: flex
    flex-direction: column
    align-items: center

  .contact-hero
    text-align: center
    margin-bottom: 80px
    max-width: 600px

  .status-banner
    display: inline-flex
    align-items: center
    gap: 8px
    padding: 6px 12px
    border-radius: 999px
    font-size: 11px
    letter-spacing: 0.08em
    background: var(--c-white-a6)
    color: var(--c-black)
    font-family: 'Zen Kaku Gothic New', sans-serif

  .status-indicator
    width: 8px
    height: 8px
    border-radius: 50%
    flex-shrink: 0

  .status-message
    font-weight: 400
    color: var(--c-gray-550)

  .status-banner--open
    background: var(--c-status-open-bg)
    color: var(--c-status-open)
    .status-indicator
      background: var(--c-status-open)

  .status-banner--limited
    background: var(--c-status-limited-bg)
    color: var(--c-status-limited)
    .status-indicator
      background: var(--c-status-limited)

  .status-banner--closed
    background: var(--c-status-closed-bg)
    color: var(--c-status-closed)
    .status-indicator
      background: var(--c-status-closed)

  .status-banner--unknown
    background: var(--c-white-a6)
    color: var(--c-white-a80)
    .status-indicator
      background: var(--c-white-a80)

  .contact-title
    color: var(--c-white)
    font-size: 48px
    font-weight: 900
    letter-spacing: 0.08em
    margin-bottom: 24px

  .contact-description
    color: var(--c-gray-550)
    font-size: 16px
    line-height: 2
    letter-spacing: 0.04em
    margin-bottom: 20px

  .primary-contacts
    display: grid
    grid-template-columns: repeat(2, 1fr)
    gap: 16px
    width: 100%
    max-width: 640px
    margin-bottom: 16px

  .social-links
    display: grid
    grid-template-columns: repeat(2, 1fr)
    gap: 16px
    width: 100%
    max-width: 640px

  .social-link-card
    display: flex
    align-items: center
    gap: 16px
    padding: 20px 24px
    background: var(--c-white-a3)
    border: 1px solid var(--c-white-a8)
    border-radius: 12px
    text-decoration: none
    color: var(--c-white-a70)
    transition: all 0.3s ease
    &:hover
      background: var(--c-white-a6)
      border-color: var(--c-accent-a30)
      color: var(--c-white)
      .social-icon
        color: var(--c-accent)
      .social-arrow
        opacity: 1
        transform: translate(2px, -2px)

  .social-icon
    width: 20px
    height: 20px
    flex-shrink: 0
    color: var(--c-white-a50)
    transition: color 0.3s ease
    :global(svg)
      width: 100%
      height: 100%
      display: block

  .social-name
    font-family: 'Zen Kaku Gothic New', sans-serif
    font-size: 15px
    font-weight: 500
    letter-spacing: 0.06em
    flex: 1

  .social-arrow
    width: 16px
    height: 16px
    flex-shrink: 0
    opacity: 0
    transition: all 0.3s ease
    svg
      width: 100%
      height: 100%
      display: block

  @media (max-width: 768px)
    main
      padding: 120px 24px 80px

    .contact-hero
      margin-bottom: 56px

    .contact-title
      font-size: 36px

    .contact-description
      font-size: 15px

    .primary-contacts
      grid-template-columns: 1fr
      max-width: 400px

    .social-links
      grid-template-columns: 1fr
      max-width: 400px

    .social-link-card
      padding: 18px 20px

    .social-arrow
      opacity: 0.4
</style>
